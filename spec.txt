APP SPEC â€” "Save to Airtable"  (Current Implementation)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0. Goal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Chrome browser extension with auto-save functionality.
â€¢ Capture Title, URL (editable), Tags â†’ write to Airtable Units table.
â€¢ Smart content type detection and URL-based deduplication.
â€¢ Real-time change tracking with conditional updates.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Airtable Contract
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BASE: env AIRTABLE_BASE_ID
TABLE: Units (default) or env AIRTABLE_TABLE

Field         Type            Filled by app   Value
------------  --------------  -------------   -------------------------
Name          Single-line     yes             page title
Link          URL             yes             canonical URL
Tags          Multiple-select yes             array of tag strings
Status        Single-select   yes             "To do" (default for new entries)
Type          Single-select   yes             auto-detected content type
(all others)  â€”               no              untouched

Required Single-Select Options:
Status: "To do", "In progress", "Done"
Type: "Twitter thread", "Reddit thread", "Video", "Article"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2. Backend API
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Platform: Vercel Serverless Functions
Env:
  AIRTABLE_PAT
  AIRTABLE_BASE_ID  
  AIRTABLE_TABLE=Units

POST /api/save  body:
{
  "url":   "<raw url>",
  "title": "<page title>",
  "tags":  ["tag1","tag2"],
  "source":"Extension"
}

GET /api/tags
Returns: {"tags": ["tag1","tag2"...], "count": N}

Process (/api/save):
1. Canonicalise URL (canonicalize function)
   â€¢ lower-case scheme+host, drop trailing "/"
   â€¢ strip tracking params: utm_*, gclid, fbclid, yclid, mc_*, irclickid,
     spm, gbraid, wbraid, vero_*, ref, ref_*
2. Dedup by URL (findByUrl function)
   GET Units?filterByFormula={Link}="canonical_url"
   if exists â†’ return 200 {duplicate:true,existingId}
3. Detect content type (detectContentType function)
   hostname-based: twitter.com/x.com â†’ "Twitter thread"
                   reddit.com â†’ "Reddit thread"
                   youtube.com/vimeo.com/etc â†’ "Video"
                   default â†’ "Article"
4. If unique (create function)
   POST Units {Name, Link, Tags, Status:"To do", Type:detected_type}
   return 201 {duplicate:false,id}
Errors â†’ 4xx/5xx {error,details}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3. Browser Extension  (MV3)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tech Stack: React + TypeScript + Vite

manifest.json (auto-generated by Vite plugin):
{
  "manifest_version": 3,
  "name": "Save to Airtable",
  "version": "1.0.0",
  "permissions": ["storage","activeTab"],
  "host_permissions": ["https://*/*", "http://*/*"],
  "action": { "default_popup": "popup.html" },
  "background": { "service_worker": "background.js" }
}

popup.tsx (React component):
 Title  <textarea value={title} onChange={handleTitleChange} rows={2}>
 URL    <textarea value={url} onChange={handleUrlChange} rows={2}>
 Tags   <input value={tags} onChange={handleTagsChange} (with typeahead)>
                     [Save/Update Button]

Behaviour:
â€¢ On mount (useEffect)
    â€“ chrome.tabs.query â†’ fill title + url from active tab
    â€“ fetch("/api/tags") â†’ populate availableTags for suggestions
    â€“ performSave(url, title, []) â†’ auto-save immediately
â€¢ On input change â†’ checkForChanges() â†’ set hasUnsavedChanges flag
â€¢ Button states:
    â€“ isLoading: "Saving..." (gray)
    â€“ !hasUnsavedChanges && savedRecordId: "âœ… Saved" (green, disabled)
    â€“ hasUnsavedChanges: "ğŸ“ Update Changes" (orange)
    â€“ default: "Save to Airtable" (blue)
â€¢ performSave()
    POST /api/save
    duplicate â†’ "âœ… Found existing entry - ready for updates"
    created   â†’ "âœ… Successfully saved to Airtable!"
    error     â†’ "âŒ Error saving to Airtable. Please try again."
â€¢ Tag suggestions: typeahead filtering from availableTags, comma-separated

Dependencies: react, react-dom (no Chakra UI, no axios)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4. Development Tools
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ dev.html: Development preview page with mocked Chrome APIs
  - Simulates chrome.tabs.query with sample data
  - Runs at http://localhost:5173/dev.html via `npm run dev`
â€¢ vite.dev.config.ts: Development server configuration
â€¢ Hot reload: Extension development with live preview

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5. Repo / File Layout  
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/api                     â† Vercel Serverless Functions
  save.ts                â† Main save endpoint with deduplication
  tags.ts                â† Dynamic tag suggestions endpoint  
  src/
    airtable.ts          â† Airtable API helpers (findByUrl, create, detectContentType)
    canonical.ts         â† URL canonicalization utilities

/extension               â† Chrome Extension (MV3)
  popup.tsx              â† React popup with auto-save
  popup.html             â† Extension popup entry point
  dev.html               â† Development preview page
  background.ts          â† Service worker
  vite.config.ts         â† Build configuration
  vite.dev.config.ts     â† Development server config
  utils/api.ts           â† API client utilities (getTags, postSave)

/backend                 â† Legacy backend (tests only)
  src/                   â† Shared utilities
  tests/
    canonical.test.ts    â† 8 URL test cases
    save.test.ts         â† API endpoint tests with mocking

/root
  spec.txt               â† This specification
  README.md              â† User documentation
  vercel.json            â† Vercel deployment config
  .github/workflows/ci.yml â† CI/CD pipeline

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6. Testing & CI/CD
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Test Framework: Vitest with Edge Runtime environment
Coverage:
â€¢ canonical.test.ts: 8 URL canonicalization scenarios
â€¢ save.test.ts: Complete API endpoint testing with mocked Airtable
â€¢ Deduplication tests: URL-based duplicate prevention
â€¢ Type detection tests: Smart content classification

Build Commands:
â€¢ Extension: cd extension && npm run build â†’ extension/dist/
â€¢ Backend: vercel --prod (auto-deploys from /api directory)
â€¢ Dev server: cd extension && npm run dev â†’ http://localhost:5173/dev.html

Deployment:
â€¢ Backend: Vercel Serverless Functions (auto-deploy from /api)
â€¢ Extension: Manual load from extension/dist/ in Chrome developer mode

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
7. Current Behavior & Acceptance Tests
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ” Auto-save on popup open â†’ immediate save with loading state
âœ” Unique URL â†’ "âœ… Successfully saved to Airtable!", green "âœ… Saved" button
âœ” Duplicate URL â†’ "âœ… Found existing entry - ready for updates"
âœ” Edit fields â†’ orange "ğŸ“ Update Changes" button appears
âœ” Update changes â†’ saves successfully, returns to "âœ… Saved" state
âœ” Type detection â†’ Twitter/Reddit/Video/Article auto-assigned
âœ” Tag suggestions â†’ fetched from Airtable, typeahead filtering
âœ” Network error â†’ "âŒ Error saving..." message, retry on next action
âœ” URL canonicalization â†’ tracking params removed, normalized
âœ” Status field â†’ "To do" automatically set for new entries

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
8. Current Implementation Notes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Auto-save happens immediately on popup open (no debouncing)
â€¢ No undo functionality (removed from original spec)
â€¢ No caching in chrome.storage (tags fetched fresh each time)
â€¢ Change tracking compares against original saved data
â€¢ Button disabled when no changes detected
â€¢ Uses native fetch API instead of axios
â€¢ No Chakra UI (custom inline styles)
â€¢ Development preview via dev.html with mocked Chrome APIs
â€¢ Vercel Serverless Functions instead of Edge Runtime
â€¢ URL-based deduplication instead of hash-based
